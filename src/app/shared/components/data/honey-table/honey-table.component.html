<div class="honey-table-container">
    <!-- Loading Overlay -->
    @if (tableConfig().loading) {
    <div class="loading-overlay">
        <div class="loading-spinner">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-honey-primary"></div>
            <p class="mt-4 text-gray-600">{{ tableConfig().loadingMessage }}</p>
        </div>
    </div>
    }

    <!-- Table Wrapper -->
    <div class="table-wrapper" [class.sticky-header]="tableConfig().stickyHeader">
        <table class="honey-table" [class.table-striped]="tableConfig().striped"
            [class.table-bordered]="tableConfig().bordered" [class.table-hoverable]="tableConfig().hoverable"
            [class.table-sm]="tableConfig().size === 'sm'" [class.table-lg]="tableConfig().size === 'lg'">

            <!-- Header -->
            <thead>
                <tr>
                    @for (column of visibleColumns(); track column.key) {
                    <th [style.width]="column.width" [class]="column.cssClass"
                        [class.text-center]="column.align === 'center'" [class.text-right]="column.align === 'right'"
                        [class.sortable]="column.sortable" [title]="column.headerTooltip"
                        (click)="onColumnSort(column)">
                        <div class="th-content">
                            <span>{{ column.label }}</span>
                            @if (column.sortable) {
                            <app-icon [name]="getSortIcon(column)" size="sm" class="sort-icon ml-1" />
                            }
                        </div>
                    </th>
                    }

                    @if (hasActionsColumn()) {
                    <th class="actions-column text-center">
                        Acciones
                    </th>
                    }
                </tr>
            </thead>

            <!-- Body -->
            <tbody>
                @if (data().length === 0 && !tableConfig().loading) {
                <!-- Empty State -->
                <tr>
                    <td [attr.colspan]="visibleColumns().length + (hasActionsColumn() ? 1 : 0)" class="empty-state">
                        <div class="empty-content">
                            <app-icon name="inbox" size="xl" class="text-gray-400 mb-2" />
                            <p class="text-gray-600">{{ tableConfig().emptyMessage }}</p>
                        </div>
                    </td>
                </tr>
                } @else {
                <!-- Data Rows -->
                @for (row of data(); track trackByRowId($index, row); let rowIndex = $index) {
                <tr (click)="onRowClick(row, rowIndex, $event)" [class.cursor-pointer]="tableConfig().hoverable">

                    @for (column of visibleColumns(); track column.key) {
                    <td [class]="column.cssClass" [class.text-center]="column.align === 'center'"
                        [class.text-right]="column.align === 'right'">

                        <!-- TEXT -->
                        @if (column.type === 'text') {
                        <span>{{ getCellValue(row, column) }}</span>
                        }

                        <!-- NUMBER -->
                        @if (column.type === 'number') {
                        <span class="font-mono">{{ getCellValue(row, column) }}</span>
                        }

                        <!-- BADGE -->
                        @if (column.type === 'badge') {
                        @if (getBadgeConfig(row, column); as badgeConfig) {
                        <app-badge [variant]="badgeConfig.variant" [icon]="badgeConfig.icon" size="sm">
                            {{ badgeConfig.label }}
                        </app-badge>
                        } @else {
                        <span>{{ getCellValue(row, column) }}</span>
                        }
                        }

                        <!-- DATE -->
                        @if (column.type === 'date') {
                        <span>{{ getCellValue(row, column) | date:'dd/MM/yyyy' }}</span>
                        }

                        <!-- EDITABLE -->
                        @if (column.type === 'editable') {
                        @if (!isEditing(row, column)) {
                        <!-- View Mode -->
                        <div class="editable-cell-view" (click)="startEdit(row, column); $event.stopPropagation()">
                            <span>{{ getCellValue(row, column) }}</span>
                            <app-icon name="pencil" size="xs"
                                class="edit-icon ml-2 opacity-0 group-hover:opacity-100" />
                        </div>
                        } @else {
                        <!-- Edit Mode -->
                        <app-editable-cell [value]="getCellValue(row, column)" [config]="column.editConfig ?? {}"
                            (save)="onCellSave(row, column, $event)" (cancel)="onCellCancel()"
                            (click)="$event.stopPropagation()" />
                        }
                        }

                        <!-- BOOLEAN -->
                        @if (column.type === 'boolean') {
                        <div class="flex justify-center">
                            @if (getCellValue(row, column)) {
                            <app-icon name="check-circle" class="text-green-600" />
                            } @else {
                            <app-icon name="x-circle" class="text-gray-400" />
                            }
                        </div>
                        }
                    </td>
                    }

                    <!-- Actions Column -->
                    @if (hasActionsColumn()) {
                    <td class="actions-column text-center">
                        <div class="relative inline-block action-menu-trigger">
                            <button (click)="toggleActionMenu(getRowId(row)); $event.stopPropagation()"
                                class="action-menu-button">
                                <app-icon name="ellipsis-vertical" size="sm" />
                            </button>

                            @if (rowActions()) {
                            <app-action-menu [config]="rowActions()!" [row]="row"
                                [isOpen]="openMenuRowId() === getRowId(row)"
                                (actionClick)="onActionClick($event, row, rowIndex)"
                                (closed)="openMenuRowId.set(null)" />
                            }
                        </div>
                    </td>
                    }
                </tr>
                }
                }
            </tbody>
        </table>
    </div>
</div>